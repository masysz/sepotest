<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DApp Interaction</title>
  <script src="https://cdn.jsdelivr.net/npm/web3/dist/web3.min.js"></script>
</head>
<body>
  <h1>Interaksi dengan Smart Contract</h1>
  <button id="connectWallet">Hubungkan Wallet</button>
  <p><strong>Status Wallet:</strong> <span id="walletStatus">Belum Terhubung</span></p>
  <hr>

  <h2>Transfer Token</h2>
  <label for="recipientAddress">Alamat Penerima:</label>
  <input type="text" id="recipientAddress" placeholder="0x...">
  <br>
  <label for="amount">Jumlah (Wei):</label>
  <input type="number" id="amount" placeholder="1000000000000000000">
  <br>
  <button id="transferToken">Transfer</button>
  <hr>

  <h2>Status</h2>
  <p><strong>Hasil Transfer:</strong> <span id="transferStatus">Belum Ada</span></p>

  <script>
    const contractAddress = "0xc520027d3eB2600c5ea5e799ea6F355D05b8b6f6";
    const abi = [
      {
        "inputs": [
          { "internalType": "address", "name": "sender", "type": "address" },
          { "internalType": "address", "name": "recipient", "type": "address" },
          { "internalType": "uint256", "name": "amount", "type": "uint256" }
        ],
        "name": "transferFrom",
        "outputs": [
          { "internalType": "bool", "name": "", "type": "bool" }
        ],
        "stateMutability": "nonpayable",
        "type": "function"
      }
    ];

    let web3;
    let contract;
    let userAccount;

    document.getElementById("connectWallet").addEventListener("click", async () => {
      if (window.ethereum) {
        try {
          await window.ethereum.request({ method: 'eth_requestAccounts' });
          web3 = new Web3(window.ethereum);
          userAccount = (await web3.eth.getAccounts())[0];
          document.getElementById("walletStatus").textContent = "Terhubung: " + userAccount;
          contract = new web3.eth.Contract(abi, contractAddress);
        } catch (error) {
          console.error("Gagal menghubungkan wallet:", error);
        }
      } else {
        alert("Metamask tidak ditemukan! Harap instal Metamask untuk melanjutkan.");
      }
    });

    document.getElementById("transferToken").addEventListener("click", async () => {
      const recipient = document.getElementById("recipientAddress").value;
      const amount = document.getElementById("amount").value;

      if (contract && userAccount) {
        try {
          const result = await contract.methods
            .transferFrom(userAccount, recipient, amount)
            .send({ from: userAccount });
          
          document.getElementById("transferStatus").textContent = "Transfer Berhasil: " + result.transactionHash;
        } catch (error) {
          console.error("Gagal melakukan transfer:", error);
          document.getElementById("transferStatus").textContent = "Transfer Gagal";
        }
      } else {
        alert("Hubungkan wallet terlebih dahulu!");
      }
    });
  </script>
</body>
</html>
